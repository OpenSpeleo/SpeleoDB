{% extends "pages/project/base.html" %}
{% load static i18n compress%}

{% load countries %}
{% load is_in_list %}
{% load survey_formats %}

{% block right_panel %}
<div class="grow">
    <div class="p-6 space-y-6">

        <!-- Page header -->
        <div class="mb-16 block">

            <!-- Left: Title -->
            <div class="mb-4 sm:mb-0 w-fit block float-left">
                <h1 class="text-2xl md:text-3xl text-slate-800 text-slate-100 font-bold">
                    Project's Revision History
                </h1>
            </div>

        </div>

        <!-- Table -->
        <div class="bg-white bg-slate-800 shadow-lg rounded-sm border border-slate-200 border-slate-700">
            <!-- Table -->
            <table class="table-auto w-full text-slate-300">
                <!-- Table header -->
                <thead class="text-xs font-semibold uppercase text-slate-400 bg-slate-900/20 border-t border-b border-slate-700">
                    <tr>
                        <th class="px-2 first:pl-5 last:pr-5 py-3">
                            <div class="font-semibold text-center">ID</div>
                        </th>
                        <th class="px-2 first:pl-5 last:pr-5 py-3">
                            <div class="font-semibold text-center">Author</div>
                        </th>
                        <th class="px-2 first:pl-5 last:pr-5 py-3">
                            <div class="font-semibold text-center">Date</div>
                        </th>
                        <th class="px-2 first:pl-5 last:pr-5 py-3 max-w-lg">
                            <div class="font-semibold text-center">Message</div>
                        </th>
                        <th class="px-2 first:pl-5 last:pr-5 py-3">
                            <div class="font-semibold text-center">Download</div>
                        </th>
                    </tr>
                </thead>
                <!-- Table body -->
                <tbody class="text-sm divide-y divide-slate-200 divide-slate-700">
                    {% for commit in commits %}
                        <!-- Row -->
                        <tr>
                            <td class="px-2 first:pl-5 last:pr-5 py-3">
                                <div class="text-center">
                                    <div class="font-medium text-slate-800 text-slate-100">{{ commit.short_id }}</div>
                                </div>
                            </td>
                            <td class="px-2 first:pl-5 last:pr-5 py-3">
                                <div class="text-center">
                                    <div class="font-medium text-slate-800 text-slate-100">{{ commit.author_email }}</div>
                                </div>
                            </td>
                            <td class="px-2 first:pl-5 last:pr-5 py-3">
                                <div class="text-center">{{ commit.committed_date|date:"Y/m/d H:i" }}</div>
                            </td>
                            <td class="px-2 first:pl-5 last:pr-5 py-3 max-w-lg">
                                <div class="text-center">
                                    <div class="font-medium text-slate-800 text-slate-100">{{ commit.message }}</div>
                                </div>
                            </td>
                            <td class="px-2 first:pl-5 last:pr-5 py-3 text-center w-16">
                                {% if not commit.message|is_in_list:skip_download_names %}
                                {% comment %} <a target="_blank" href="{% url 'api:v1:download_project_at_hash' id=project.id commit_sha1=commit.short_id %}">
                                    <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-lock-open stroke-current h-6 text-indigo-500 inline" viewBox="0 0 24 24" stroke-width="1.5" stroke="#2c3e50" fill="none" stroke-linecap="round" stroke-linejoin="round">
                                        <path d="M19 18a3.5 3.5 0 0 0 0 -7h-1a5 4.5 0 0 0 -11 -2a4.6 4.4 0 0 0 -2.1 8.4" />
                                        <path d="M12 13l0 9" />
                                        <path d="M9 19l3 3l3 -3" />
                                    </svg>
                                </a> {% endcomment %}
                                <!-- Menu button -->
                                <div class="relative inline-flex" x-data="{ open: false }">
                                    <button class="rounded-full" :class="open ? 'bg-slate-700 text-slate-400': 'text-slate-500 hover:text-slate-400'" aria-haspopup="true" @click.prevent="open = !open" :aria-expanded="open">
                                        <span class="sr-only">Menu</span>
                                        <svg class="w-8 h-8 fill-current" viewBox="0 0 32 32">
                                            <circle cx="16" cy="16" r="2" />
                                            <circle cx="10" cy="16" r="2" />
                                            <circle cx="22" cy="16" r="2" />
                                        </svg>
                                    </button>
                                    <div class="origin-top-right z-10 absolute top-full right-0 min-w-36 bg-slate-800 border border-slate-700 py-1.5 rounded shadow-lg overflow-hidden mt-1" @click.outside="open = false" @keydown.escape.window="open = false" x-show="open" x-transition:enter="transition ease-out duration-200 transform" x-transition:enter-start="opacity-0 -translate-y-2" x-transition:enter-end="opacity-100 translate-y-0" x-transition:leave="transition ease-out duration-200" x-transition:leave-start="opacity-100" x-transition:leave-end="opacity-0" x-cloak>
                                        <ul>
                                            {% get_project_formats project as dl_formats %}
                                            {% for dl_format in dl_formats %}
                                                {% if dl_format.creation_date|date:"Y/m/d H:i" <= commit.committed_date|date:"Y/m/d H:i" %}
                                                <li>
                                                    <a class="font-medium text-sm text-slate-300 hover:text-slate-200 flex py-1 px-3 mb-2" @click="open = false" @click="open = false" @focus="open = true" @focusout="open = false" target="_blank" href="{% url 'api:v1:download_project_at_hash' id=project.id commit_sha1=commit.short_id fileformat=dl_format.format|lower %}">{{ dl_format.format|title }}</a>
                                                </li>
                                                {% endif %}
                                            {% endfor %}
                                            <li>
                                                <a class="font-medium text-sm text-slate-300 hover:text-slate-200 flex py-1 px-3 mb-2" @click="open = false" @click="open = false" @focus="open = true" @focusout="open = false" target="_blank" href="{% url 'api:v1:download_project_at_hash' id=project.id commit_sha1=commit.short_id fileformat='dump' %}"> Everything (ZIP)</a>
                                            </li>
                                        </ul>
                                    </div>
                                </div>
                                {% endif %}
                            </td>
                        </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>

    </div>
</div>
{% endblock right_panel %}
