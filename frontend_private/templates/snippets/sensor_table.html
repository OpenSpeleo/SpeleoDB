{% comment %}
Reusable sensor table snippet.

Parameters:
- sensors: List of sensor objects
- table_id: ID for the table (default: "sensors_table")
- show_actions: Whether to show action buttons (default: False)
- has_write_access: Whether user has write access (for conditional display)
- empty_message: Message to show when no sensors (default: "No sensors")
- show_count: Whether to show sensor count (default: True)
{% endcomment %}

{% if sensors %}
<div class="bg-slate-900/20 rounded-lg border border-slate-700 overflow-hidden">
    <table id="{{ table_id|default:'sensors_table' }}" class="table-auto w-full">
        <thead class="text-xs font-semibold uppercase text-slate-400 bg-slate-900/40">
            <tr>
                <th class="px-4 py-3 text-left">Sensor Name</th>
                <th class="px-4 py-3 text-center">Status</th>
                <th class="px-4 py-3 text-left">Project</th>
                <th class="px-4 py-3 text-left">Latitude</th>
                <th class="px-4 py-3 text-left">Longitude</th>
                <th class="px-4 py-3 text-left">Mem Expiry</th>
                <th class="px-4 py-3 text-left">Bat Expiry</th>
                {% if show_actions|default:False and has_write_access|default:False %}
                <th class="px-4 py-3 text-center">Actions</th>
                {% endif %}
            </tr>
        </thead>
        <tbody class="text-sm divide-y divide-slate-700" id="{{ table_id|default:'sensors_table' }}_body">
            {% for sensor in sensors %}
            <tr class="sensor-row" data-sensor-id="{{ sensor.id }}">
                <td class="px-4 py-3">
                    <div class="font-medium text-slate-100">{{ sensor.name }}</div>
                    <div class="text-xs text-slate-400 md:hidden mt-1">{{ sensor.notes|truncatewords:8 }}</div>
                </td>
                <td class="px-4 py-3 text-center">
                    {% if sensor.is_functional %}
                    <span
                        class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-emerald-500/20 text-emerald-300 border border-emerald-500/30">
                        ✓ Functional
                    </span>
                    {% else %}
                    <span
                        class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-rose-500/20 text-rose-300 border border-rose-500/30">
                        ✗ Not Functional
                    </span>
                    {% endif %}
                </td>
                {% with install=sensor.active_installs|first %}
                <td class="px-4 py-3 text-sm text-slate-300">
                    {{ install.station.project.name|default:"-" }}
                </td>
                <td class="px-4 py-3 text-sm text-slate-300">
                    {{ install.station.latitude|default:"-" }}
                </td>
                <td class="px-4 py-3 text-sm text-slate-300">
                    {{ install.station.longitude|default:"-" }}
                </td>
                {% endwith %}
                {% with install=sensor.active_installs|first %}
                <td class="px-4 py-3 text-sm text-slate-300">
                    {{ install.expiracy_memory_date|date:"Y-m-d"|default:"-" }}
                </td>
                <td class="px-4 py-3 text-sm text-slate-300">
                    {{ install.expiracy_battery_date|date:"Y-m-d"|default:"-" }}
                </td>
                {% endwith %}
                {% if show_actions|default:False and has_write_access|default:False %}
                <td class="px-4 py-3">
                    <div class="flex items-center justify-center gap-2">
                        <button type="button"
                            class="toggle-sensor-btn text-xs px-2 py-1 rounded {% if sensor.is_functional %}bg-rose-500/20 hover:bg-rose-500/30 text-rose-300{% else %}bg-emerald-500/20 hover:bg-emerald-500/30 text-emerald-300{% endif %} w-24"
                            data-sensor-id="{{ sensor.id }}"
                            data-is-functional="{{ sensor.is_functional|lower }}">
                            {% if sensor.is_functional %}Mark Broken{% else %}Mark Fixed{% endif %}
                        </button>
                        <button type="button"
                            class="edit-sensor-btn text-xs px-2 py-1 rounded bg-indigo-500/20 hover:bg-indigo-500/30 text-indigo-300"
                            data-sensor-id="{{ sensor.id }}">
                            Edit
                        </button>
                        <button type="button"
                            class="delete-sensor-btn text-xs px-2 py-1 rounded bg-rose-500/20 hover:bg-rose-500/30 text-rose-300"
                            data-sensor-id="{{ sensor.id }}">
                            Delete
                        </button>
                    </div>
                </td>
                {% endif %}
            </tr>
            {% endfor %}
        </tbody>
    </table>
</div>
{% if show_count|default:True %}
<div class="mt-3 text-sm text-slate-400">
    Total sensors: <span class="font-semibold text-slate-300" id="sensor_count">{{ sensors|length }}</span>
</div>
{% endif %}
{% else %}
<div
    class="text-center py-12 bg-slate-900/20 rounded-lg border-2 border-dashed border-slate-700">
    <svg xmlns="http://www.w3.org/2000/svg" class="h-12 w-12 mx-auto text-slate-600 mb-3"
        fill="none" viewBox="0 0 24 24" stroke="currentColor">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
            d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z" />
    </svg>
    <p class="text-slate-500 mb-4">{{ empty_message|default:"No sensors" }}</p>
</div>
{% endif %}

